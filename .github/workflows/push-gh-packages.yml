name: Build & publish docker images
on:
  pull_request:
    types: [opened,synchronize]

env:
  REGISTRY: ghcr.io
  IMAGE_NAME: ${{ github.repository }}
  GITHUB_COMMIT: ${{ github.sha }}

jobs:
  detect_changes:
    runs-on: ubuntu-latest
    outputs:
      artifacts: ${{ steps.mod-files.outputs.artifacts }}
    steps: 
    - name: Checkout repository
      uses: actions/checkout@v4
    - name: debug git
      id: mod-files
      run: echo "artifacts=$(git diff-tree --no-commit-id --diff-filter=M --name-only -r ${{ github.sha }} )" >> "$GITHUB_OUTPUT"
    #- name: Setup Python
    #  uses: actions/setup-python@v5
    #  with:
    #    python-version: '3.13.0'
    #- name: Run Script
    #  run: python -u .github/scripts/create-matrix.py
    #  id: get-matrix
    #- name: Output JSON
    #  run: |
    #    echo "artifacts=$(cat output.json)" >> $GITHUB_OUTPUT
    #- name: Debug
    #  run: cat output.json && git version && echo "${GITHUB_COMMIT}"

  printJob:    
    name: Print event
    runs-on: ubuntu-latest
    steps:
    - name: Dump GitHub context
      env:
        GITHUB_CONTEXT: ${{ toJson(github) }}
      run: |
        echo "$GITHUB_CONTEXT"